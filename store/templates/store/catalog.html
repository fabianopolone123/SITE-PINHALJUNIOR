{% extends "base.html" %}
{% block title %}Loja{% endblock %}
{% block menu %}
    <a href="{% url 'dashboard' %}">Início</a>
    <a href="{% url 'store-catalog' %}">Loja</a>
    <a href="{% url 'store-orders' %}">Meus pedidos</a>
    <a href="{% url 'store-cart' %}">Carrinho</a>
    <a href="{% url 'logout' %}">Sair</a>
{% endblock %}
{% block content %}
    <div class="card">
    <div class="chip">Loja</div>
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap:14px; align-items:stretch;">
        {% for product in products %}
        <div style="border:1px solid #e2e8f0; border-radius:12px; padding:12px; background:#f8fafc; display:flex; flex-direction:column; gap:10px; align-items:center; text-align:center; height:100%;">
            <div style="margin-bottom:8px; width:100%;">
                {% if product.image_url %}
                    <img src="{{ product.image_url }}" alt="{{ product.name }}" style="width:100%; max-height:160px; object-fit:cover; border-radius:10px;">
                {% else %}
                    <div style="height:160px; border-radius:10px; background:linear-gradient(135deg,#a5b4fc,#c4f1f9); display:grid; place-items:center; color:#0f172a; font-weight:800;">
                        {{ product.name }}
                    </div>
                {% endif %}
            </div>
            <div style="flex:1; display:flex; flex-direction:column; gap:6px; width:100%;">
                <div>
                    <strong>{{ product.name }}</strong><br>
                    <small>{{ product.category }}</small>
                </div>
                <p style="margin:0;">{{ product.description|default:"" }}</p>
                <p style="margin:4px 0;"><strong>Estoque:</strong> {{ product.stock }}</p>
                <div style="font-weight:800;">R$ {{ product.price }}</div>
            </div>
            <form method="post" action="{% url 'store-add-to-cart' product.id %}" style="display:grid; gap:8px; width:100%; margin-top:auto;">
                {% csrf_token %}
                {% if product.variants.all %}
                    {% with variants=product.variants.all %}
                    <label style="display:block; text-align:left;">Variação:
                        <select name="variant_id" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:8px;">
                            {% for v in variants %}
                            <option value="{{ v.id }}">{{ v.name }} - R$ {{ v.price }} ({{ v.stock }} em estoque)</option>
                            {% endfor %}
                        </select>
                    </label>
                    {% endwith %}
                {% elif product.opt_list %}
                    <label style="display:block; text-align:left;">Opções:
                        <select name="option" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:8px;">
                            {% for opt in product.opt_list %}
                            <option value="{{ opt }}">{{ opt }}</option>
                            {% endfor %}
                        </select>
                    </label>
                {% endif %}
                <div style="display:flex; align-items:center; gap:6px; justify-content:center;">
                    <button type="button" class="qty-minus" style="padding:6px 10px; border:none; border-radius:8px; background:#e2e8f0; min-width:36px;">-</button>
                    <input type="number" name="quantity" value="1" min="1" style="width:60px; text-align:center; padding:6px 8px; border:1px solid #cbd5e1; border-radius:8px;">
                    <button type="button" class="qty-plus" style="padding:6px 10px; border:none; border-radius:8px; background:#e2e8f0; min-width:36px;">+</button>
                </div>
                <button type="submit" style="padding:10px 14px; background:#22c55e; color:#fff; border:none; border-radius:10px; font-weight:800; width:100%;">Adicionar ao carrinho</button>
            </form>
        </div>
        {% empty %}
        <p>Nenhum produto disponível.</p>
        {% endfor %}
    </div>
</div>
<script>
document.querySelectorAll('.qty-minus').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const input = e.target.nextElementSibling;
        input.value = Math.max(1, parseInt(input.value || '1') - 1);
    });
});
document.querySelectorAll('.qty-plus').forEach(btn => {
    btn.addEventListener('click', (e) => {
        const input = e.target.previousElementSibling;
        input.value = parseInt(input.value || '1') + 1;
    });
});
</script>
{% endblock %}
